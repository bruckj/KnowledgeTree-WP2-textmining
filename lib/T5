import nltk
import os
import re
import io


txtDir = 'C:\\Users\\Lenovo\\Documents\\files\\'
metaPath = 'C:\\Users\\Lenovo\\Documents\\'

#megnyitja a fájlokat, ami benne van a parseolt txtDir-ben
def referencesFind(txtDir, metaPath):        
        for txt in os.listdir(txtDir):
                textFile = open(txtDir + txt, "r", encoding='utf-8')
                text = textFile.read()
                sents = nltk.sent_tokenize(text)
                references = re.compile(r'\(\'(\d+)\'\,\s\'(.*?\“|.*?\:)(.*?\”|.*?\.)(.*?\')\)', re.MULTILINE)
                line_list = []
                number_list = []
                author_list = []
                publication_list = []
                otherInfo_list = [] 
                ref_list = []
                                
# megkeresi a hivatkozásokat a parseolt txt-ben (4 capturing group + full match)
          
                for line in references.finditer(text):
                        number, author, publication, otherInfo = line.groups()      # itt vannak a capturing groupok
                        number_list.append(number)                                  # a hivatkozásszám, ami alapján majd keresünk a txt-ben
                        for number in number_list:                                  # [1] ilyen formátumba keresse
                                number = number.replace(number, "["+number+"]")                 
                        author_list.append(author)                                  # szerző(k)
                        publication_list.append(publication)                        # publikációs cím
                        for publication in publication_list:                        # ideiglenes megoldás, most még a fájlok neve a publication
                                if "?" in publication:                              # és fájlnévben nem örül a '?'-nek
                                        publication = publication[:-2]              # később az adott fáj ID-ja lesz                       
                        otherInfo_list.append(otherInfo)                            # minden más (miben, hol publikálták, stb.)
                        ref_list.append(line)

# keresi a szövegben a cross referenceket a felismert számok alapján és kiírja fájlba (jelenleg cikk címe + txt)

                                for count, line in enumerate(sents):
                                        line_list.append(line) 
                                        if number in line and "]" not in line_list[count-1]:    # ha van az előző mondatban '[' (tehát másik hivatkozás) ne írja ki
                                                filename = metaPath + publication + ".txt"
                                                f = open(filename, "ab+")                       # ha létezik append, ha nem akkor kreál egy ilyen fájlt
                                                f.write(line.encode("utf-8"))
                                                f.close()
                textFile.close()
